# Guia de Estudos: Arquitetura e Versionamento de Prompts

## 1. Introdução: Prompt-as-Code
O versionamento de prompts é a prática de tratar prompts de IA como código de software. O objetivo é trazer a rigeza da engenharia de software (LLMOps) para o desenvolvimento de IA Generativa, garantindo rastreabilidade, organização e segurança nas atualizações.

**Conceito Chave:** Prompts não devem ser "strings mágicas" soltas no meio do código da aplicação, mas sim ativos gerenciados separadamente.

---

## 2. Estrutura de Diretórios Sugerida
A organização proposta separa a lógica da aplicação (código fonte) da lógica dos prompts.

```text
meu-projeto/
├── src/                      # Código fonte da aplicação (React, Python, etc.)
└── prompts/                  # Diretório raiz de gerenciamento de prompts
    ├── registry.yaml         # Arquivo Indexador (Catálogo de Agentes)
    ├── agent-code-reviewer/  # Pasta do Agente Específico
    │   ├── README.md         # Documentação Humana
    │   └── v1.0.0/           # Pasta da Versão Específica
    │       └── prompt.yaml   # O Prompt compilado com metadados
    └── agent-pull-request-creator/
        ├── README.md
        └── v1.0.1/
            └── prompt.yaml
```

---

## 3. Componentes da Arquitetura

### A. O Indexador (`registry.yaml`)
Funciona como a "porta de entrada" ou "catálogo de serviços". Ele mapeia o nome lógico do agente para sua localização física e versão atual.

**Função:** Permite atualizar a versão do prompt (ex: de v1.0 para v1.1) alterando apenas este arquivo, sem precisar fazer deploy do código da aplicação (`src`).

```yaml
# prompts/registry.yaml
agents: 
  agent-code-reviewer:
    description: "Agente especializado em revisão rigorosa de código"
    current_version: "1.0.0"
    path: "agent-code-reviewer/v1.0.0/prompt.yaml"
    model: gpt-5-nano  # Modelo associado a esta versão

  agent-pull-request-creator:
    description: "Agente para criação de pull requests profissionais"
    current_version: "1.0.1"
    path: "agent-pull-request-creator/v1.0.1/prompt.yaml"
    model: gpt-4-turbo
```

### B. Documentação do Agente (`README.md`)
Cada agente deve ter seu próprio manual. Isso é crucial para a "Developer Experience" (DX).

**O que deve conter:**
* **Descrição:** O que o agente faz.
* **Variáveis de Entrada:** O que preciso enviar para ele funcionar (ex: `code_diff`, `language`).
* **Casos de Uso:** Onde aplicar (CI/CD, CLI, etc.).
* **Changelog:** Histórico de mudanças entre versões.

### C. O Prompt Versionado (`prompt.yaml`)
Este é o núcleo. Em vez de um arquivo `.txt` simples, usamos YAML para enriquecer o prompt com metadados técnicos e configurações.

**Campos Importantes:**
* `_type`: Tipo do objeto (prompt, chain, agent).
* `id`: Identificador único.
* `version`: Versão semântica.
* `input_variables`: Lista explícita de variáveis (previne erros de execução).
* `template`: O texto do prompt em si.

**Exemplo de Arquivo (`agent-code-reviewer/v1.0.0/prompt.yaml`):**

```yaml
_type: prompt
id: agent-code-reviewer
version: 1.0.0
input_variables:
  - code_diff
  - language
  - repo_rules
  - security_level
  - review_focus
template: |
  Você é um revisor de código sênior especializado em análise rigorosa e detalhada.

  ## Contexto da Revisão
  **Linguagem:** {language}
  **Nível de Segurança:** {security_level}
  **Foco da Revisão:** {review_focus}

  ## Regras do Repositório
  {repo_rules}

  ## Código para Revisão
  {code_diff}

  ## Instruções de Análise
  Analise o código fornecido considerando os seguintes aspectos:
  1. Segurança (OWASP Top 10)
  2. Performance (Complexidade, Memória)
  3. Qualidade (SOLID, Legibilidade)
  
  ## Formato da Resposta
  Estruture sua resposta com RESUMO EXECUTIVO, ISSUES CRÍTICOS e MELHORIAS RECOMENDADAS.
```

---

## 4. Fluxo de Trabalho (Workflow)

1.  **Criação:** Desenvolvedor cria uma nova pasta `v1.1.0` com melhorias no `prompt.yaml`.
2.  **Documentação:** Atualiza o `README.md` com as mudanças no Changelog.
3.  **Registro:** Atualiza o `registry.yaml` mudando a `current_version` de "1.0.0" para "1.1.0".
4.  **Execução:** O sistema lê o registry, identifica o path da versão atual e carrega o template correto.

---

## 5. Por que usar essa estrutura?

| Benefício | Descrição |
| :--- | :--- |
| **Desacoplamento** | O código da aplicação não fica "sujo" com textos longos de prompts. |
| **Imutabilidade** | Ao usar pastas por versão, garantimos que versões antigas continuam existindo e funcionando (histórico preservado). |
| **Rollback Rápido** | Se a nova versão falhar, basta voltar o `registry.yaml` para a versão anterior. |
| **Testabilidade** | Facilita a criação de testes automatizados para cada versão específica do prompt. |